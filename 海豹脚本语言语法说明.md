### 内置脚本语言

#### 变量

- **变量前缀**:
- 无前缀：玩家的角色属性，如 `力量`、`理智`、`智力`。
- `$t` 开头：个人临时变量，仅在单次指令执行期间有效，不存入数据库。例如：`$t随机点数`。
- `$m` 开头：个人变量，在不同群组间持久存在。例如：`$m今日人品`。
- `$g` 开头：群变量，在群内由所有用户共享。例如：`$g群主体重`。
- **内置变量**:
- `$t玩家`: 当前人物卡名，若无则为群昵称或 QQ 昵称。
- `$t玩家_RAW`: 同上，但不含 `< >`。
- `$tQQ昵称`: QQ 昵称。
- `$t账号ID` / `$tQQ`: 海豹格式的 ID，如 `QQ:123456789`。
- `$t账号ID_RAW`: 原始 ID，如 `123456789`。
- `$t群名`: 群名称。
- `$t群号` / `$t群号_RAW`: 群 ID，分别为海豹格式和原始格式。
- `$t个人骰子面数`: 用户的骰子面数设置。
- 日期/时间变量：`$tDate`, `$tYear`, `$tMonth`, `$tDay`, `$tWeekday` (1-7), `$tHour`, `$tMinute`, `$tSecond`, `$tTimestamp` (10 位时间戳)。
- `$t文本长度`: 触发消息的文本长度，汉字长度为 3，字母和数字为 1。
- `$t平台`: 触发指令的平台，如 `QQ`。
- `$t游戏模式`: 游戏模式，随 `.set coc/dnd` 改变。
- `$t消息类型`: 消息类型，`group` 或 `private`。
- `$tMsgID`: 消息 ID，仅用于自定义回复。
- 自定义文案：所有自定义文案都可以作为变量使用，如 `娱乐:今日人品`。
- 常量：`常量:APPNAME` (软件名), `常量:VERSION` (版本号)。

#### 数据类型和赋值

- **文本类型**: 使用单引号 `' '`、双引号 `" "` 或反引号 `` ` `` 包裹。反引号支持在内部使用 `{ }` 或 `{% %}` 插入表达式，如 `` `玩家的力量数值：{力量}` ``。
- **数字类型**: 直接使用数字，如 `1`。
- **布尔类型**: 没有专门的布尔类型。`0` 或空字符串被视为 `False`，非零数字和非空字符串为 `True`。
- **赋值**: 使用 `=` 进行赋值，例如 `$t0 = '文本'`。

#### 语句

- **执行块**: `{% %}` 被称为执行块，其中的代码会被执行，并输出最后一个语句的结果。
- 语句之间用 `;` 隔开。
- 如果最后一个语句是字符串，其结果会被输出。
- 执行块中的变量调用需要用反引号包裹，例如 `{% \$t1="114514" %}` 会输出 `114514`。
- **多语句**: 多个语句可用 `;` 分隔。表达式的值为分隔后最后一项的值。
- **注意**: 最后一个语句后不应有分号。

#### 运算符

- **数学运算**:
- `+`, `-`, `*`, `/`, `%` (加、减、乘、除、取余)
- `^` 或 `**` (乘方)，例如 `2 ** 3` 或 `2 ^ 3` 表示 23
- **逻辑运算**:
- `&&` (逻辑与)
- `||` (逻辑或)
- `!` (逻辑非)
- **比较运算**:
- `==` (等于)
- `!=` (不等于)
- `>`, `<`, `>=`, `<=` (大于、小于、大于等于、小于等于)
- **骰子算符**:
- `d`: 常规骰子，如 `d20`。
- `f`: 命运骰。
- `b`: CoC 奖励骰。
- `p`: CoC 惩罚骰。
- `c`: 双十字。

#### 条件语句和算符

- **条件算符 `?`**:
- 单条件：`条件 ? '结果'`。
- 多重条件：`条件1 ? '结果1', 条件2 ? '结果2', ...`。
- 三目运算：`条件 ? '真值' : '假值'`。
- **条件语句 `if`**:

```
if 条件 {
// 条件为真时执行的语句
} else {
// 条件为假时执行的语句
}
```

- 不支持 `else if` 或 `elif`。`if` 和 `else` 是一对一匹配的。
- 条件中的 `||` 和 `&&` 是从左往右计算的，如有需要，应使用括号来控制优先级。
- **多行回复**:
- 通常不直接在自定义回复中换行，而是在为变量赋值时在字符串内写入 `\n`。
- 在自定义回复中将多个变量写在同一行，以避免因某个变量为空而产生突兀的空行。例如：`{$t输出0}{$t输出1}{$t输出2}`。

#### 示例片段

- **限定每人/每群每天一次**:
- **写法 1**: 利用 `$m` (个人) 或 `$g` (群) 变量和 `$tDate` (日期) 变量作为标记。
- 文本匹配：`你需要的文本`；表达式为真：`$m变量 != $tDate`；回复：`{if 1 {$m变量=$tDate}}你需要的回复文本`。
- 文本匹配：`你需要的文本`；表达式为真：`$m变量==$tDate`；回复：`在一天触发多次时的回复`。
- **写法 2**: 使用一个 `if...else` 执行块。
Plaintext

```
{%
if $m变量 != $tDate {
$t输出 = `你需要的回复文本`;
$m变量 = $tDate
} else {
$t输出 = `在一天触发多次时的回复`
}
%}
{$t输出}
```

- **多条件判断与赋值**:
- 在同一个 `if` 内使用条件算符赋值：
Plaintext

```
{%
if 1 {
$tRand=d3;
$tDicePlay = $tRand==1 ? "石头", $tRand==2 ? "剪刀", 1 ? "布"
}
%}
```

- 新开一行使用条件语句赋值：
Plaintext

```
{%
if 1 {
$tRand=d3;
};
if $tRand==1 {$tDicePlay="石头"};
if $tRand==2 {$tDicePlay="剪刀"};
if $tRand==3 {$tDicePlay="布"}
%}
```

### 示例

```
// 变量赋值
$t随机点数 = 1d100; // 单次指令执行的临时变量
力量 = 65; // 玩家角色属性
$g群主体重 = 180; // 群变量
$m猫好感 = 1050; // 个人持久变量
// 内置变量使用
`{$t玩家}，你的力量为{力量}。今天的日期是{$tYear}-{$tMonth}-{$tDay}。`; // 使用反引号和插值语法
`游戏模式: {$t游戏模式}, 消息类型: {$t消息类型}`; // 使用反引号和插值语法
// 逻辑与数学运算
$t判断结果 = (力量 > 50) && (1d100 >= 50); // 逻辑与运算
$t伤害 = 1d6 + 5; // 骰子算符和数学运算
$t乘方结果 = 2 ** 4; // 乘方运算
// 条件算符（多重条件）
{%
    $m猫好感 <= 100 ? `你和猫的关系很差，猫不理你`,
    $m猫好感 <= 250 ? `你和猫的关系一般，猫对你爱答不理`,
    $m猫好感 <= 600 ? `你和猫的关系不错，猫会蹭你`,
    $m猫好感 <= 1500 ? `你和猫的关系很好，猫会向你撒娇`,
    1 ? `你和猫的关系非常好，是猫的专属铲屎官` // 最后的1作为默认条件
%}
// 条件语句（if-else）
{%
    if 力量 > 70 {
    $t回复 = `你的力量非常强大！`
} else {
    $t回复 = `你的力量还可以，继续努力。`
};
    $t回复 // 注意：最后一个语句后没有分号
%}
// 牌堆与自定义回复结合（嵌套条件算符）
{%
    $m猫好感 <= 100 ? `#{DRAW-第一档猫好感}`,
    $m猫好感 <= 250 ? `#{DRAW-第二档猫好感}`,
    1 ? `#{DRAW-第三档猫好感}` // 1作为默认条件
%}
// 限定每人每天一次（写法2）
{%
    if $m每日签到 != $tDate {
    $t输出 = `{$t玩家}，你今天签到成功了！获得了1d10的金币。`;
    $m每日签到 = $tDate; // 对变量赋值作为标记
} else {
    $t输出 = `{$t玩家}，你今天已经签过到了。`
};
$t输出
%}
// 多条件条件语句（石头剪刀布示例）
$t玩家出招 = '石头';
$t骰子出招 = `{% $tRand=d3; if $tRand==1 {"剪刀"} else if $tRand==2 {"石头"} else {"布"} %}`;
{%
    if $t玩家出招 == $t骰子出招 {
    $t输出 = `平局！我们都出了{$t玩家出招}。`
};
if ($t玩家出招=="剪刀" && $t骰子出招=="石头") || ($t玩家出招=="石头" && $t骰子出招=="布") || ($t玩家出招=="布" && $t骰子出招=="剪刀") {
    $t输出 = `你输了！我出了{$t骰子出招}，你出了{$t玩家出招}。`
};
if ($t玩家出招=="石头" && $t骰子出招=="剪刀") || ($t玩家出招=="布" && $t骰子出招=="石头") || ($t玩家出招=="剪刀" && $t骰子出招=="布") {
    $t输出 = `你赢了！我出了{$t骰子出招}，你出了{$t玩家出招}。`
};
$t输出
%}
```

特别说明：if 后必须有至少一个空格或换行
# {SPLIT}和\n是换行标记符
\f是分段标记符
